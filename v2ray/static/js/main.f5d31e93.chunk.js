(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],[,,,,,,,,,,function(e,t,a){e.exports=a(18)},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),s=a.n(o),i=a(9),c=a.n(i),l=(a(15),a(2)),u=a(3),h=a(6),v=a(5),f=a(7),d=(a(16),a(1)),m=a(4);a(17);!function(e){e.START="START",e.OVER="OVER",e.PAUSE="PAUSE"}(n||(n={})),function(e){e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(r||(r={}));var p={straight:[[[0,0,0,0],[1,1,1,1]],[[0,1],[0,1],[0,1],[0,1]]],square:[[[1,1,0,0],[1,1,0,0]]],T:[[[0,1,0,0],[1,1,1,0]],[[1,0],[1,1],[1,0]],[[1,1,1],[0,1,0],[0,0,0]],[[0,0,1],[0,1,1],[0,0,1]]],rightSnake:[[[0,1,1,0],[1,1,0,0]],[[1,0],[1,1],[0,1]]],leftSnake:[[[1,1,0,0],[0,1,1,0]],[[0,1],[1,1],[1,0]]],leftGun:[[[1,0,0,0],[1,1,1,0]],[[1,1,0],[1,0,0],[1,0,0]],[[1,1,1],[0,0,1],[0,0,0]],[[0,0,1],[0,0,1],[0,1,1]]],rightGun:[[[0,0,1,0],[1,1,1,0]],[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0],[0,0,0]],[[0,1,1],[0,0,1],[0,0,1]]]},k={straight:{shapeIndex:0,color:"cyan"},square:{shapeIndex:0,color:"yellow"},T:{shapeIndex:0,color:"purple"},rightSnake:{shapeIndex:0,color:"green"},leftSnake:{shapeIndex:0,color:"red"},leftGun:{shapeIndex:0,color:"blue"},rightGun:{shapeIndex:0,color:"orange"}},g=["straight","square","T","rightSnake","leftSnake","leftGun","rightGun"];function S(){var e,t,a=g[(e=0,t=g.length,e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e)],n=p[a][0];return Object(d.a)({type:a,offsetX:4,offsetY:0,shape:n},k[a])}function y(e,t,a){return t<0&&(t=0),a<0&&(a=0),0!==e[a][t]}function w(e,t,a){var n=a.offsetX,r=a.offsetY,o=a.shape,s=!1,i=!1,c=0,l=0;switch(e){case"left":c=-1;break;case"right":c=1;break;case"down":default:l=1}for(var u=0;u<o.length;u++)for(var h=0;h<o[u].length;h++){if(o[u][h]){var v=c+n+h,f=l+r+u;(v<0||f>=20||v>=10||y(t,v,f))&&(s=!0),s&&0===r&&"down"===e&&(i=!0)}}return i?"GAME_OVER":s}function b(e){for(var t=[],a=e.shape,n=e.offsetX,r=e.offsetY,o=0;o<a.length;o++)for(var s=0;s<a[o].length;s++)a[o][s]&&t.push({x:s+n,y:o+r});return t}function E(e,t,a){for(var n=a||e.color,r=JSON.parse(JSON.stringify(t)),o=b(e),s=0;s<o.length;s++){var i=o[s],c=i.x;r[i.y][c]=n}return r}function O(e,t){for(e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));!w("down",t,e);)e.offsetY++;return e}var N=new(function(){function e(t){Object(l.a)(this,e),this.queueLen=void 0,this.queue=void 0,this.queueLen=t,this.queue=[],this.fill()}return Object(u.a)(e,[{key:"getQueue",value:function(){return this.queue}},{key:"fill",value:function(){for(;this.queue.length<this.queueLen;)this.queue.push(S())}},{key:"getNext",value:function(){var e=this.queue.shift();return this.fill(),e}}]),e}())(5),B=function(e){function t(e){var a;Object(l.a)(this,t),(a=Object(h.a)(this,Object(v.a)(t).call(this,e))).intervel=void 0,a.nextBlockView=function(){return a.state.blockQueue.map((function(e,t){var a=e.shape.map((function(t,a){var n=t.map((function(t,a){var n={};return t&&(n.backgroundColor=e.color),s.a.createElement("td",{key:a,className:"gameBlock",style:n})}));return s.a.createElement("tr",{key:a},n)}));return s.a.createElement("table",{key:"".concat(t),className:"blockView"},s.a.createElement("tbody",null,a))}))};var n=function(e,t){for(var a=[],n=0;n<t;n++){for(var r=[],o=0;o<e;o++)r.push(0);a.push(r)}return a}(e.width,e.height),r=N.getNext();return a.state={blockQueue:N.getQueue(),currBlock:r,previewBlock:O(r,n),map:JSON.parse(JSON.stringify(n)),archivedMap:JSON.parse(JSON.stringify(n)),score:0,level:1,startTime:Date.now()},a.handleShortCut=a.handleShortCut.bind(Object(m.a)(a)),a.handleMoving=a.handleMoving.bind(Object(m.a)(a)),a.handleRotation=a.handleRotation.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleShortCut)}},{key:"componentWillReceiveProps",value:function(e){e.gameStatus!==this.props.gameStatus&&("STARTING"===e.gameStatus?this.gameStart():(clearInterval(this.intervel),window.removeEventListener("keydown",this.handleRotation),window.removeEventListener("keydown",this.handleMoving)))}},{key:"handleMoving",value:function(e){switch(e.keyCode){case 37:e.preventDefault(),this.moveBlock("left");break;case 39:e.preventDefault(),this.moveBlock("right");break;case 40:e.preventDefault(),this.moveBlock("down");break;case 32:e.preventDefault(),this.moveToBottom()}}},{key:"handleRotation",value:function(e){switch(e.keyCode){case 38:e.preventDefault(),this.rotateBlock()}}},{key:"handleShortCut",value:function(e){switch(e.keyCode){case 80:e.preventDefault(),this.props.handleKeyboardShortCut("p");break;case 83:e.preventDefault(),this.props.handleKeyboardShortCut("s")}}},{key:"getNextBlock",value:function(){this.setState({currBlock:N.getNext()})}},{key:"addScore",value:function(e){this.setState({score:this.state.score+e.length})}},{key:"updateArchivedMap",value:function(e){console.log("\u9700\u8981\u6e05\u9664\u7684\u884c\uff1a",e);var t=function(e,t){var a=JSON.parse(JSON.stringify(e)),n=!0,r=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(n=(s=i.next()).done);n=!0)for(var c=s.value,l=0;l<10;l++)a[c][l]=0}catch(f){r=!0,o=f}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}for(var u=t[0]-1;u>=0;u--)for(var h=t.length,v=0;v<10;v++)a[u+h][v]=a[u][v];return a}(E(this.state.currBlock,this.state.archivedMap,""),e);this.setState({archivedMap:t})}},{key:"updateMap",value:function(){var e=this.state,t=e.previewBlock,a=e.archivedMap,n=e.currBlock,r=E(t,a,"#b2b7bc4d");r=E(n,r),this.setState({map:r})}},{key:"tick",value:function(){var e=this,t=this.state,a=t.archivedMap,n=t.currBlock;this.setState({currBlock:n,previewBlock:O(n,a)},(function(){e.updateMap(),e.autoDrop()}))}},{key:"moveRight",value:function(){this.setState({currBlock:Object(d.a)({},this.state.currBlock,{offsetX:this.state.currBlock.offsetX+1})})}},{key:"moveLeft",value:function(){this.setState({currBlock:Object(d.a)({},this.state.currBlock,{offsetX:this.state.currBlock.offsetX-1})})}},{key:"moveDown",value:function(){this.setState({currBlock:Object(d.a)({},this.state.currBlock,{offsetY:this.state.currBlock.offsetY+1})})}},{key:"moveToBottom",value:function(){var e=this;this.setState({currBlock:this.state.previewBlock},(function(){e.moveBlock("down")}))}},{key:"rotateBlock",value:function(){var e=JSON.parse(JSON.stringify(this.state.currBlock));e=function(e){var t=e.shapeIndex+1;return t%=p[e.type].length,Object(d.a)({},e,{shape:p[e.type][t],shapeIndex:t})}(e),w("rotation",this.state.archivedMap,e)||"STARTING"!==this.props.gameStatus||this.setState({currBlock:e})}},{key:"moveBlock",value:function(e){var t=w(e,this.state.archivedMap,this.state.currBlock);if("PAUSING"!==this.props.gameStatus&&"GAME_OVER"!==this.props.gameStatus)switch(e){case"left":return void(!1===t&&this.moveLeft());case"right":return void(!1===t&&this.moveRight());case"down":if(!1===t)this.moveDown();else if("GAME_OVER"===t)this.GameOver();else{var a=function(e,t){var a=[],n=E(t,e),r=b(t).reduce((function(e,t){return e[t.y]=e[t.y]?e[t.y]+1:1,e}),[]);for(var o in console.log("TCL: getCompletedLines -> rows",r),r){for(var s=!0,i=0;i<10;i++)0===n[o][i]&&(s=!1);s&&a.push(parseInt(o))}return a}(this.state.archivedMap,this.state.currBlock);this.updateArchivedMap(a),this.addScore(a),this.getNextBlock()}return;default:return}}},{key:"autoDrop",value:function(){var e=this,t=Date.now(),a=600-100*this.state.level;t-this.state.startTime>=a&&"PAUSING"!==this.props.gameStatus&&"GAME_OVER"!==this.props.gameStatus&&this.setState({startTime:t},(function(){e.moveBlock("down")}))}},{key:"gameStart",value:function(){var e=this;this.intervel=setInterval((function(){e.tick()}),10),this.setState({startTime:Date.now()}),window.addEventListener("keydown",this.handleMoving),window.addEventListener("keydown",this.handleRotation)}},{key:"GameOver",value:function(){this.props.handleGameStatus("GAME_OVER")}},{key:"renderMap",value:function(){return this.state.map&&this.state.map.map((function(e,t){var a=e.map((function(e,a){var n={};return e&&(n.backgroundColor=e.toString()),s.a.createElement("td",{className:"gameBlock",id:"cell".concat(t).concat(a),key:10*a+t,style:n})}));return s.a.createElement("tr",{className:"row",id:"row".concat(t),key:10*t},a)}))}},{key:"handleLevelChange",value:function(e){var t=this;this.setState({level:parseInt(e.target.value)},(function(){console.log(t.state.level)}))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{className:"gameInfo gameLevel"},"Level:",s.a.createElement("select",{value:this.state.level,onChange:this.handleLevelChange.bind(this)},s.a.createElement("option",{value:1},"1"),s.a.createElement("option",{value:2},"2"),s.a.createElement("option",{value:3},"3"),s.a.createElement("option",{value:4},"4"),s.a.createElement("option",{value:5},"5")),s.a.createElement("span",{style:{marginLeft:"1em"}},"Score:",this.state.score)),s.a.createElement("div",{className:"gameArea"},s.a.createElement("table",{className:"tableview"},s.a.createElement("tbody",{className:"map"},this.renderMap())),s.a.createElement("div",{className:"nextBlock"},"Next:",this.state.blockQueue&&this.nextBlockView())))}}]),t}(o.Component),G=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(h.a)(this,Object(v.a)(t).call(this,e))).state={gameStatus:"",startClicked:!1},a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"startOrRestartGame",value:function(){"STARTING"===this.state.gameStatus||"GAME_OVER"===this.state.gameStatus?window.location.reload():this.setState({gameStatus:"STARTING",startClicked:!0})}},{key:"pauseOrResumeGame",value:function(){"STARTING"===this.state.gameStatus?this.setState({gameStatus:"PAUSING"}):this.setState({gameStatus:"STARTING"})}},{key:"handleGameStatus",value:function(e){this.setState({gameStatus:e})}},{key:"handleKeyboardShortCut",value:function(e){"s"===e?this.startOrRestartGame():"p"===e&&this.pauseOrResumeGame()}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},s.a.createElement("h3",null,"\u4fc4\u7f57\u65af\u65b9\u5757\u513f")),s.a.createElement("div",{className:"App-content"},s.a.createElement("div",{className:"helper-container"},"\u201c\u2190\u201d\uff0c\u201c\u2192\u201d\uff0c\u201c\u2193\u201d\u952e\u63a7\u5236\u79fb\u52a8",s.a.createElement("br",null),"\u65b9\u5411\u201c\u2191\u201d\u952e\u5207\u6362\u5f62\u6001",s.a.createElement("br",null),"\u7a7a\u683c\u6389\u843d",s.a.createElement("br",null),"P\u6682\u505c/\u7ee7\u7eed",s.a.createElement("br",null),"S\u5f00\u59cb/\u91cd\u65b0\u5f00\u59cb\u6e38\u620f",s.a.createElement("div",{className:"menu"},this.state.gameStatus,s.a.createElement("br",null),s.a.createElement("button",{onClick:this.startOrRestartGame.bind(this)},this.state.startClicked?"\u91cd\u65b0\u5f00\u59cb":"\u5f00\u59cb\u6e38\u620f"),!!this.state.gameStatus&&s.a.createElement("button",{onClick:this.pauseOrResumeGame.bind(this)},"PAUSING"===this.state.gameStatus?"\u7ee7\u7eed":"\u6682\u505c"))),s.a.createElement("div",{className:"game-container"},s.a.createElement(B,{width:10,height:20,gameStatus:this.state.gameStatus,handleGameStatus:this.handleGameStatus.bind(this),handleKeyboardShortCut:this.handleKeyboardShortCut.bind(this)}))))}}]),t}(o.Component),R=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(s.a.createElement(G,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");R?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):T(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):T(t,e)}))}}()}],[[10,1,2]]]);
//# sourceMappingURL=main.f5d31e93.chunk.js.map